<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<link rel="shortcut icon" href="http://i.imgur.com/gA3TP.png">
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Crossword Constructor</title>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script type="text/javascript">
			// HTML contents of cells and rows
			var cell = '<div class="cellContainer"><input class="cell" type="text" maxlength="1"></input><div class="cellNum"></div></div>';
			var row = '<div class="row"></div>';
			
			// Essentially static variables for this iteration of the site
			var numRows = 15;
			var numCols =15;
			var andrewsCrossword1 = [5, 6, 10, 14, 20, 25, 35, 40, 60, 61, 62, 69, 73, 74, 78, 79, 83, 89, 95, 96, 100, 101, 112, 123, 124, 128, 129, 135, 141, 145, 146, 150, 151, 155, 162, 163, 164, 184, 189, 199, 204, 210, 214, 218, 219];
			var andrewsCrossword2 = [4, 8, 9, 19, 24, 34, 39, 60, 61, 65, 68, 73, 74, 78, 81, 85, 88, 89, 94, 100, 101, 102, 103, 104, 120, 121, 122, 123, 124, 130, 135, 136, 139, 143, 146, 150, 151, 156, 159, 163, 164, 185, 190, 200, 205, 215, 216, 220];
			var lockeSol1 = ['O','N','I','O','N','','','A','F','T','','C','S','T','','P','A','N','G','E','','D','N','A','S','','L','O','S','T','A','T','O','R','S','','E','D','N','A','','O','U','R','S','L','O','N','E','S','T','A','R','C','O','U','N','T','R','Y','','','','S','Y','D','N','E','Y','','M','E','H','','','A','B','S','','','S','S','W','','B','A','S','A','L','','N','O','O','S','E','','','S','A','R','','','S','O','B','T','R','U','E','L','I','E','','W','A','R','M','I','C','E','E','A','T','','','T','A','E','','','B','E','A','K','S','','T','H','A','I','S','','M','A','S','','','N','E','O','','','H','R','S','','I','B','E','R','I','A','','','','B','L','A','C','K','S','T','A','R','N','A','T','I','O','N','M','A','N','A','','T','E','R','O','','M','O','O','D','Y','I','C','O','N','','E','C','G','S','','I','N','T','E','S','','K','I','E','','T','H','O','','','T','E','A','S','E'];
			var lockeSol2 = ['B','E','S','T','','K','A','L','','','P','L','U','C','K','R','E','N','I','','O','C','A','L','','S','A','M','O','A','A','C','A','R','','C','R','Y','O','','A','D','O','R','N','T','H','R','E','E','H','E','E','L','C','L','I','C','K','S','','','E','D','S','','S','R','','U','M','E','H','','','S','O','S','','T','D','','S','P','T','','S','A','','','O','N','E','S','','O','B','O','E','S','','','','','','C','O','M','I','N','G','O','F','A','G','E','T','A','L','E','','','','','','S','A','S','S','Y','','A','R','E','A','','','B','P','','P','S','T','','M','E','','M','E','T','','','I','O','T','A','','O','T','','L','I','L','','','Y','E','L','L','O','W','B','R','I','C','K','R','O','A','D','A','M','B','I','T','','A','I','T','E','','O','A','T','Y','B','R','O','C','A','','S','E','A','T','','N','D','A','K','A','S','S','E','T','','','S','N','O','','S','S','N','E'];
			var currentSol = '';
			
			// Boolean to track whether the user is in Edit or Solve mode
			var editMode = false;
			
			// Public counter for counting which cell was last numbered
			var counter = 1;
			
			// Functions for removing the puzzle elements
			function deleteCells(){
				$(".cells").remove();
			}
			function deleteRows(){
				$(".row").remove();
			}
			
			// Functions for modifying strings. For use in the puzzle input and output
			function removeBrackets(stringWithBrackets){
				return stringWithBrackets.replace(/[\[\]']+/g, '');
			}
			
			function removeApostrophes(stringWithApostrophes){
				return stringWithApostrophes.replace(/'/g, '');
			}
			
			// Functions for determining whether a cell in the crossword is an edge cell.
			function isTopRowCell(cellNumber){
				return cellNumber<numCols;
			};
			
			function isBotRowCell(cellNumber){
				var finalCell = numCols*numRows-1;
				return cellNumber > finalCell - numCols;
			};
			
			function isLeftColCell(cellNumber){
				return cellNumber%numCols==0;
			};
			
			function isRightColCell(cellNumber){
				return cellNumber%numCols==(numCols-1);
			};
			
			
			// Functions returning adjacent cells
			function $cellAbove(cellNumber){
				return $($('.cell')[cellNumber-numCols]);
			};
			function $cellBelow(cellNumber){
				return $($('.cell')[cellNumber+numCols]);
			};
			function $cellLeft(cellNumber){
				return $($('.cell')[cellNumber-1]);
			};
			function $cellRight(cellNumber){
				return $($('.cell')[cellNumber+1]);
			};
			
			//Helper function for making a cell void
			function makeVoid(cell){
				removeCorrectness(cell);
				cell.addClass('void');
			}
			
			// Helper function for making a cell toggle void
			function toggleVoid(cell){
				if(cell.hasClass('void')){
					cell.removeClass('void');
				} 
				else {
					makeVoid(cell);
				}
			}
			
			// Helper function to remove correctness from a cell
			function removeCorrectness(cell){
				cell.removeClass('correct');
				cell.removeClass('incorrect');
			}
			
			//Functions for determining whether adjacent cells are void
			function hasLetterAbove(cellNumber){
				return ((!isTopRowCell(cellNumber)) && (!$cellAbove(cellNumber).hasClass('void')));
			};
			
			function hasLetterBelow(cellNumber){
				return ((!isBotRowCell(cellNumber)) && (!$cellBelow(cellNumber).hasClass('void')));
			};
			
			function hasLetterLeft(cellNumber){
				return ((!isLeftColCell(cellNumber)) && (!$cellLeft(cellNumber).hasClass('void')));
			};
			
			function hasLetterRight(cellNumber){
				return ((!isRightColCell(cellNumber)) && (!$cellRight(cellNumber).hasClass('void')));
			};
			
			function isLoneCell(cellNumber){
				return ((!hasLetterAbove(cellNumber) && !hasLetterBelow(cellNumber)) || (!hasLetterLeft(cellNumber) && !hasLetterRight(cellNumber)));
			};
			
			/*
			Functions to input and output data about the puzzle. Input methods accept
			either arrays or comma-separated string representing arrays
			*/
			
			function outputVoids(){
				var cellString = '';
				var cellArray = new Array();
				var $cells = $('.cell');
				for (var i = 0, ii = $cells.length; i < ii; i++){
					if($($cells[i]).hasClass('void')){
						if(cellString.length > 0){
							cellString += ', ';
						} 
						cellString += i;
						cellArray[cellArray.length]=i;
					}
				}
				return cellArray;
			};
			
			function inputVoids(voidArray){
				if(Object.prototype.toString.call(voidArray) === '[object String]'){
					voidArray = removeBrackets(voidArray).split(',');
				}
				$cells = $('.cell');
				$cells.removeClass('void');
				for (var i = 0; i < voidArray.length; i++){
					makeVoid($($cells[voidArray[i]]));
				}
			};
			
			function outputLetters(){
				$cells = $('.cell');
				var cellArray = new Array();
				for (var i =0; i<$cells.length; i++){
					$cell = $($cells[i]);
					if ($cell.hasClass('void')){
						cellArray[i] = '';
					}
					else {
						cellArray[i] = $cell.val();
					}
				}
				return cellArray;
			};
			
			function inputLetters(letterArray){
				if(Object.prototype.toString.call(letterArray) === '[object String]'){
					letterArray = removeBrackets(letterArray).split(',');
				}
				$cells = $('.cell');
				for (var i = 0; i<$cells.length; i++){
					$($cells[i]).val(letterArray[i]);
				}
			};
			
			//Function to automatically number the cells of a blank puzzle
			function numberCells(){
				$cells = $('.cell');
				$cellNums = $('.cellNum');
				counter = 1;
				for(var i = 0; i<$cells.length; i++){
					$cell = $($cells[i]);
					$cellNum = $($cellNums[i]);
					
					if(!$cell.hasClass('void') && !isLoneCell(i)){
						if(isTopRowCell(i)){
							addNumber($cellNum);
						}
						else if (isLeftColCell(i)){
							addNumber($cellNum);
						} 
						else if($cellAbove(i)){
							if($cellAbove(i).hasClass('void')){
								addNumber($cellNum);
							} 
							else if($cellLeft(i)){
								if ($cellLeft(i).hasClass('void')){
									addNumber($cellNum);
								}
							}
						}
					}
				}
				counter = 1;
			};
			
			//Helper function for adding numbers to non-void cells
			function addNumber(el){
				el.text(''+counter);
				counter+=1;
			};
			
			// Functions for clearing various parts of the puzzle
			function clearNumbers(){
				$('.cellNum').text('');
			};
			
			function clearVoids(){
				$('.cell').removeClass('void');
			};
			
			function clearLetters(){
				$('.cell').val('');
			};
			
			function clearCorrectness(){
				$('.cell').removeClass('correct');
				$('.cell').removeClass('incorrect');
			};
			
			function clearCells(){
				clearLetters();
				clearNumbers();
				clearVoids();
				clearCorrectness();
				$('#cheatResult').text('');
			};
			
			//Hunt functions
			function getClueOrientation(){	
				return $('input[name=clueOrientation]:checked', '#clueForm').val();
			}
			
			/*
			
			*/
			function compareAnswers(){
				$cells = $('.cell');
				correctLetters = 0;
				totalLetters = 0;
				for(var i = 0; i< $cells.length; i++){
					$cell = $($cells[i]);
					if (!$cell.hasClass('void')){
						totalLetters += 1;
						if(($cell.val().toLowerCase() === currentSol[i].toLowerCase()) && (!$cell.hasClass('incorrect'))){
							correctLetters += 1;
							$cell.addClass('correct');
						}
						else {
							$cell.addClass('incorrect');
							$cell.val(currentSol[i]);
						}
					
					}
				}
				var congrats = (correctLetters > 0.8*totalLetters)? 'Awesome job!' : 'Sucks, brah.';
				$('#cheatResult').text('You got '+ correctLetters + ' out of ' + totalLetters+' correct. ' + congrats);
			};
			
			//Function that changes the crossword from Edit Mode to Solve Mode and back
			function toggleMode(){
				editMode = !editMode;
				if(editMode){
					$('#modeButton').text('EDIT');
				}
				else {
					$('#modeButton').text('SOLVE');
				}
				$('#modeButton').toggleClass('editMode solveMode');
			}
			
			/*
			Document load function that sets up the puzzle cells and prepares the dblclick
			event listener to allow the users to change cells to and from void
			*/
			$(document).ready(function(){
				for (var i = 0; i<numRows; i++){
					$("#cword").append(row);
				}
				for (var i = 0; i<numCols; i++){
					$(".row").append(cell);
				}
				$(".cell").dblclick(function() {
					$(this).val('');
					toggleVoid($(this));
				});
				$(".cell").click(function(){
					if(editMode){
						$(this).val('');
						toggleVoid($(this));
					}
				});
			});
		</script>
		<style type="text/css">
			input.cell {
				max-width: 1em;
				margin: 0;
				font-size: 16px;
				padding: 2px;
				border-style: solid;
				border-width: 1px;
				text-align: center;
				position: relative;
			}
			div.row {
				clear: both;
			}
			.void {
				background-color: black;
			}
			.cellNum {
				background-color: none;
				position: absolute;
				font-size: 8px;
				min-width: 1em;
				min-height: 1em;
				max-width: 1em;
				max-height: 1em;
				top: 0.1em;
				left: 0.1em;
			}
			.cellContainer{
				position: relative;
				background-color: gray;
				border: 0;
				float: left;
				padding: 0;
				margin: 0;
				overflow:auto;
			}
			body {
				margin: 0;
				padding: 1em;
				font-family:'Helvetica Neue',Arial,sans-serif;
			}
			#cword {
				overflow: auto;
				clear: none;
				float: left;
				margin: 0.5em 1em 0 0.5em;
				-webkit-box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5);
				-moz-box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5);
				box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5);
			}
			#cwordControls {
				float: left;
				overflow: auto;
				width: 370px;
			}
			#cwordInputOutput {
				clear: right;
				display: block;
			}
			#outputVoids {
				clear: right;
				display: block;
			}
			.inputOutputButton {
				float: left;
				display: block;
			}
			.correct {
				background-color: lightgreen;
			}
			
			.incorrect {
				background-color: pink;
			}
			
			#puzzleBox {
				border: 2px solid black;
				height: 500px;
				padding: 4px;
				background-color: #eee;
				width: 750px;
			}
			h3 {
				text-align: center;
				margin: 0.5em 0 0.5em 0;
			}
			h5 {
				margin: 0.5em 0 0.5em 0;
				clear: left;
			}
			#credit {
				position: absolute;
				bottom: 0em;
				right: 0em;
				font-size: 10px;
			}
			#topPuzzleBox {
				width: inherit;
				height: 375px;
			}
			#botPuzzleBox {
				position: relative;
				height: 130px;
			}
			.editMode {
				color: coral;
			}
			.solveMode {
				color: green;
			}
			.mode {
				overflow: auto;
				margin-left: 0.8em;
				margin-bottom: 0.5em;
			}
			button{
				margin: 0;
			}
			#modeButton {
				-webkit-border-radius: 0px;
				-moz-border-radius: 0px;
				border-radius: 0px;
				font-family:'Helvetica Neue',Arial,sans-serif;
				font-weight: bold;
				font-size: smaller;
				width: 65px;
				height: 22px;
				
			}
			.mode span{
				margin: 2px 0;
				float: left;
				vertical-align: center;
			}
			.left {
				float: left;
			}
			#dim {
				padding-left: 110px;
				width: 40px;
				font-size: 10px;
			}
			#clueForm {
				font-size: 10px;
			}
			#clueForm input, #clueForm span, #clueForm button{
				float: left;
			}
		</style>
	</head>
	<body>
		<div id='puzzleBox'>
			<div id="topPuzzleBox">
				<div id='cword'></div>
				<div id='cwordControls'>
					
					<h3>Crossword Wizard</h3>
					<hr />
					<h5>Puzzle Controls</h5>
					<input type="button" value="Clear Voids" id="clearVoids" onclick="clearVoids(); clearNumbers(); return false;"/>
					<input type="button" value="Void All" id="voidAll" onclick="makeVoid($('.cell')); return false;"/>
					<input type="button" value="Renumber Cells" id="renumber" onclick="clearNumbers(); numberCells(); return false;"/>
					<hr />
					<h5>Clues</h5>
						<form id="clueForm">
							<input type="radio" name="clueOrientation" value="Across"><span>Across</span><br>
  							<input type="radio" name="clueOrientation" value="Down"><span>Down</span><br>
  							<input type="checkbox" name="replaceClue" value="Replace?" ><span>Replace Existing?</span></input>
							<button id="clueButton" value="Add Clue" >Add Clue</button>
							
						</form><br />
					<hr />
					<h5>Load Popular Puzzles</h5>
					<input type="button" value="Locke #1" id="locke1" onclick="clearCells(); inputVoids(andrewsCrossword1); numberCells(); currentSol = lockeSol1; return false;" />
					<input type="button" value="Locke #2" id="locke2" onclick="clearCells(); inputVoids(andrewsCrossword2); numberCells(); currentSol = lockeSol2; return false;" />
					<hr />
					<h5>Cheat</h5>
					<input type="button" value="See Solution" id="solution" onclick="compareAnswers(); return false;"/><br />
					<span id='cheatResult'></span>
					<hr />
				</div>
			</div>
			<div id="botPuzzleBox">
				<div class="mode"><span class="left">Current Mode: &nbsp;</span><button id="modeButton" class="solveMode left" value="SOLVE" onclick="toggleMode(); return false;">SOLVE</button><div id="dim" class="left"><span id="rowDim">15</span><span>&nbsp;x&nbsp;</span><span id="colDim">15</span></div></div>
				<h5>Puzzle Data (comma-separated)</h5>
				<textarea id="cwordInputOutput" rows = "3" cols="100" placeholder="Input or output data about this crossword"></textarea>
				<input class='inputOutputButton' type="button" value="Input Voids" id="inputVoids" onclick=" inputVoids($('#cwordInputOutput').val()); return false;" />
				<input class='inputOutputButton' type="button" value="Output Voids" id="outputVoids" onclick="$('#cwordInputOutput').val('['+outputVoids().join(',')+']'); return false;" />
				<input class='inputOutputButton' type="button" value="Input Letters" id="inputLetters" onclick="inputLetters($('#cwordInputOutput').val()); return false;" />
				<input class='inputOutputButton' type="button" value="Output Letters" id="outputLetters" onclick="$('#cwordInputOutput').val('['+outputLetters().join(',')+']'); return false;"/>
				<br />
				<div id="credit">Made by Dylan O'Shea, 2012</div>
			</div>
		</div>
	</body>
</html>